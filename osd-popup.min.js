!function(){"use strict";let e=window.discPopCONFIG||{},t,o,n,i,l=!1,u=!1,r=!1,c=null,d=null,s=null,p=null;function a(t,o){let n=new Date().getTime(),i=n+1e3*o;return localStorage.setItem(`${t}EndTime`,i.toString()),e.debugMode&&console.log(`${t} timer end time set:`,new Date(i)),i}function g(e){let t=localStorage.getItem(`${e}EndTime`);if(!t)return null;let o=parseInt(t),n=new Date().getTime(),i=o-n;return i<=0?(localStorage.removeItem(`${e}EndTime`),0):Math.ceil(i/1e3)}function m(t){localStorage.removeItem(`${t}EndTime`),e.debugMode&&console.log(`${t} timer end time cleared`)}function h(){let t=e.countdown.popup;return 60*(t.minutes||0)+(t.seconds||0)}function f(){let t=e.countdown.checkoutTimer;return 60*(t.minutes||0)+(t.seconds||0)}function b(){if(e.countdown&&e.countdown.popup&&void 0!==e.countdown.popup.warningThreshold){let t=e.countdown.popup.warningThreshold;if("object"==typeof t&&null!==t){let o=t.minutes||0,n=t.seconds||0;return 60*o+n}if("number"==typeof t)return t}return 120}function $(){if(e.countdown&&e.countdown.checkoutTimer&&void 0!==e.countdown.checkoutTimer.warningThreshold){let t=e.countdown.checkoutTimer.warningThreshold;if("object"==typeof t&&null!==t){let o=t.minutes||0,n=t.seconds||0;return 60*o+n}if("number"==typeof t)return t}return 180}function y(){if(e.countdown&&e.countdown.popup&&void 0!==e.countdown.popup.urgentThreshold){let t=e.countdown.popup.urgentThreshold;if("object"==typeof t&&null!==t){let o=t.minutes||0,n=t.seconds||0;return 60*o+n}if("number"==typeof t)return t}return 60}function w(){if(e.countdown&&e.countdown.checkoutTimer&&void 0!==e.countdown.checkoutTimer.urgentThreshold){let t=e.countdown.checkoutTimer.urgentThreshold;if("object"==typeof t&&null!==t){let o=t.minutes||0,n=t.seconds||0;return 60*o+n}if("number"==typeof t)return t}return 60}function v(){return!e.countdown||!e.countdown.popup||void 0===e.countdown.popup.autoCloseOnZero||e.countdown.popup.autoCloseOnZero}function k(){return e.countdown&&e.countdown.checkoutTimer&&void 0!==e.countdown.checkoutTimer.autoHideOnZero?e.countdown.checkoutTimer.autoHideOnZero:e.checkoutTimer?.autoHide!==!1}function T(){return!e.countdown||!e.countdown.checkoutTimer||void 0===e.countdown.checkoutTimer.clearCouponOnZero||e.countdown.checkoutTimer.clearCouponOnZero}function C(){if(e.debugMode){let t=e=>{let t=Math.floor(e/60),o=e%60;return t>0&&o>0?`${t}m ${o}s`:t>0?`${t}m`:`${o}s`};console.log("Timer Configuration Loaded:",{popup:{totalTime:t(h()),warningThreshold:t(b()),urgentThreshold:t(y()),autoClose:v()},checkoutTimer:{totalTime:t(f()),warningThreshold:t($()),urgentThreshold:t(w()),autoHide:k(),clearCoupon:T()}});let o=h(),l=b(),u=y(),r=f(),c=$(),d=w();l>=o&&console.warn("⚠️ WARNING: Popup warning threshold should be less than total popup time"),u>=l&&console.warn("⚠️ WARNING: Popup urgent threshold should be less than warning threshold"),c>=r&&console.warn("⚠️ WARNING: Checkout timer warning threshold should be less than total notification time"),d>=c&&console.warn("⚠️ WARNING: Checkout timer urgent threshold should be less than warning threshold")}n=h(),i=f()}function M(){return window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function I(e){let t=M();return t?e.mobile:e.desktop}function E(){if(e.popupScale){let t=document.querySelector(".coupon-popup"),o;if("object"==typeof e.popupScale){let n=window.innerWidth;o=n<=480?e.popupScale.mobile||.9:n<=768?e.popupScale.tablet||1:e.popupScale.desktop||1.1}else o=e.popupScale;1!==o&&t.style.setProperty("--popup-scale",o),e.debugMode&&console.log(`Popup scale set to: ${o} (screen: ${window.innerWidth}px)`)}if(e.checkoutTimerScale){let i=document.querySelector(".checkout-timer");if(!i)return;let l;if("object"==typeof e.checkoutTimerScale){let u=window.innerWidth;l=u<=480?e.checkoutTimerScale.mobile||.9:u<=768?e.checkoutTimerScale.tablet||.95:e.checkoutTimerScale.desktop||1}else l=e.checkoutTimerScale;i.style.setProperty("--checkout-timer-scale",l),e.debugMode&&console.log(`Checkout timer scale set to: ${l} (screen: ${window.innerWidth}px)`)}if(e.checkoutTimer){let r=document.querySelector(".checkout-timer");if(r){let c=e.checkoutTimer.position||"top";r.classList.remove("position-top","position-bottom"),r.classList.add(`position-${c}`);let d=e.checkoutTimer.offsetDistance||20;r.style.setProperty("--notification-offset",`${d}px`);let s=document.getElementById("checkoutTimerText");s&&e.checkoutTimer.message&&(s.textContent=e.checkoutTimer.message),e.debugMode&&console.log(`Checkout timer positioned: ${c} with ${d}px offset`)}}let p=document.querySelector(".popup-title");p&&(p.innerHTML=e.coupon.title);let a=document.querySelector(".countdown-title");a&&(a.innerHTML=e.coupon.countdownTitle);let g=document.querySelector(".popup-subtitle");if(g){let m=e.coupon.subtitle;m=m.replace("{discount}",e.coupon.discount),g.innerHTML=m}let h=document.getElementById("kod-kupon");h&&(h.textContent=e.coupon.code);let f=document.getElementById("copyMessage");f&&(f.innerHTML=e.coupon.copyMessage);let b=document.getElementById("copyButton");b&&(b.textContent=e.coupon.copyButtonText),e.debugMode&&console.log("Popup content initialized with discPopCONFIG values")}function S(){if(0===e.showIntervalDays)return!0;let t=localStorage.getItem("couponPopupLastShown");if(!t)return!0;let o=new Date(parseInt(t)),n=new Date,i=Math.floor((n-o)/864e5);return e.debugMode&&console.log(`Days since last shown: ${i}, Required interval: ${e.showIntervalDays}`),i>=e.showIntervalDays}function P(t){if(r){e.debugMode&&console.log("Popup already triggered, ignoring additional triggers");return}if(!S()){e.debugMode&&console.log("Popup blocked by interval restriction");return}let o=g("popup");if(null!==o&&o>0){e.debugMode&&console.log("Active timer already exists, not creating new one");return}r=!0,e.debugMode&&console.log(`Popup triggered by: ${t}`),a("popup",h()),x(),q(),D()}function D(){c&&document.removeEventListener("mousemove",c),d&&window.removeEventListener("scroll",d),s&&s.disconnect(),p&&clearTimeout(p)}function B(t="timer"){if(!e.autoDisableCoupon.enabled)return;let o=e.autoDisableCoupon;setTimeout(()=>{let n=document.querySelector('input[name="coupon_code"]');n&&(("disable"===o.disableMethod||"both"===o.disableMethod)&&(n.disabled=!0,n.classList.add("coupon-disabled")),("hide"===o.disableMethod||"both"===o.disableMethod)&&(n.style.display="none"));let i=document.querySelector("#coupon_claim");if(i&&(("disable"===o.disableMethod||"both"===o.disableMethod)&&(i.disabled=!0,i.classList.add("coupon-disabled"),i.onclick=function(e){return e.preventDefault(),!1}),("hide"===o.disableMethod||"both"===o.disableMethod)&&(i.style.display="none")),o.showDisableMessage&&function t(o=!1){let n=e.autoDisableCoupon,i=document.getElementById("couponDisabledMessage");i&&i.remove();let l=document.createElement("div");l.id="couponDisabledMessage",l.textContent=o?n.intervalDisableMessage:n.disableMessage;let u=document.querySelector("#coupon_claim");u&&u.parentNode?u.parentNode.insertBefore(l,u.nextSibling):document.body.appendChild(l)}("interval-restriction"===t),"popup-timer-zero"===t||"checkout-timer-zero"===t){let l=new Date().getTime();localStorage.setItem("couponTimerExpired",l.toString())}e.debugMode&&console.log(`Coupon elements disabled due to: ${t}`)},500)}function L(){let e=document.getElementById("couponDisabledMessage");e&&e.remove()}function x(){let t=document.getElementById("couponPopup");if(t.classList.add("show"),e.showIntervalDays>0){let o=new Date().getTime();localStorage.setItem("couponPopupLastShown",o.toString())}e.debugMode&&console.log("Popup shown")}function _(){let o=document.getElementById("couponPopup");o.classList.remove("show"),t&&(clearInterval(t),t=null),m("popup"),D(),e.debugMode&&console.log("Popup closed")}function O(){let t=document.getElementById("checkoutTimer");t.classList.add("show"),function t(){document.getElementById("checkoutTimeDisplay");let n=document.getElementById("checkoutTimer"),l=w(),u=$();o&&clearInterval(o),localStorage.getItem("checkoutEndTime")||a("checkout",f()),o=setInterval(()=>{let t=g("checkout");if(null===t){clearInterval(o),o=null;return}if((i=t)<=0){clearInterval(o),o=null,m("checkout"),e.autoDisableCoupon.enabled&&e.autoDisableCoupon.onCheckoutTimerZero&&B("checkout-timer-zero"),k()&&function t(){let n=document.getElementById("checkoutTimer");n.classList.remove("show"),o&&(clearInterval(o),o=null),m("checkout"),e.debugMode&&console.log("Checkout timer hidden")}(),T()&&R();return}(function e(){let t=Math.floor(i/60),o=i%60,n=document.getElementById("checkoutTimeDisplay");n.textContent=`${t}:${o.toString().padStart(2,"0")}`})(),i<u&&i>l&&!n.classList.contains("warning")&&(n.classList.add("warning"),e.debugMode&&console.log(`Checkout timer entered warning mode at ${i} seconds`)),i<l&&!n.classList.contains("urgent")&&(n.classList.remove("warning"),n.classList.add("urgent"),e.debugMode&&console.log(`Checkout timer entered urgent mode at ${i} seconds`))},1e3)}(),e.debugMode&&console.log("Checkout timer shown")}function N(){try{let t=document.createElement("input");t.value="",document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),e.debugMode&&console.log("Clipboard cleared using fallback method")}catch(o){e.debugMode&&console.log("Fallback clipboard clear failed:",o)}}function R(){!function t(){try{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText("").then(()=>{e.debugMode&&console.log("Clipboard cleared successfully")}).catch(t=>{e.debugMode&&console.log("Failed to clear clipboard:",t),N()}):N()}catch(o){e.debugMode&&console.log("Error clearing clipboard:",o)}}();let t=document.getElementById("coupon_cancel");t&&t.click()}function q(){document.getElementById("timeDisplay");let o=document.getElementById("countdownTimer"),i=y(),u=b();t&&clearInterval(t),t=setInterval(()=>{if(l)return;let r=g("popup");if(null===r){clearInterval(t),t=null;return}if((n=r)<=0){clearInterval(t),t=null,m("popup"),e.autoDisableCoupon.enabled&&e.autoDisableCoupon.onPopupTimerZero&&B("popup-timer-zero"),v()&&_();return}(function e(){let t=Math.floor(n/60),o=n%60,i=document.getElementById("timeDisplay");i.textContent=`${t}:${o.toString().padStart(2,"0")}`})(),n<u&&n>i&&!o.classList.contains("warning")&&(o.classList.add("warning"),e.debugMode&&console.log(`Popup countdown entered warning mode at ${n} seconds`)),n<i&&!o.classList.contains("urgent")&&(o.classList.remove("warning"),o.classList.add("urgent"),o.style.animation="pulse 1s infinite",e.debugMode&&console.log(`Popup countdown entered urgent mode at ${n} seconds`))},1e3)}function G(e,t,o,n){let i=document.createElement("input");i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),i.remove(),H(t,o,n)}function H(t,o,n){u=!0,t.classList.add("show"),n.classList.add("hide"),o.classList.add("checkout-kupon"),o.textContent=e.coupon.checkoutButtonText,a("checkout",f()),e.debugMode&&console.log("Coupon copied successfully")}function A(){!function e(){let t=`<!-- Main Popup HTML -->
<div id="couponPopup" class="coupon-popup-overlay">
    <div class="coupon-popup">
        <button class="popup-close" id="popupClose" onclick="window.OSDPopup.closeCouponPopup(); window.OSDPopup.disableCouponElements();">&times;</button>

        <h2 class="popup-title"><!-- Content will be populated from discPopCONFIG --></h2>
        
        <div class="countdown-timer" id="countdownTimer">
            <div class="countdown-title"><!-- Content will be populated from discPopCONFIG --></div> 
            <div class="time-display">⏰ <span id="timeDisplay"></span></div>
        </div>
        
        <p class="popup-subtitle" id="popupSubtitle"><!-- Content will be populated from discPopCONFIG --></p>
        
        <div class="copy-message" id="copyMessage">
            <!-- Content will be populated from discPopCONFIG -->
        </div>

        <div class="kupon-section">
            <div id="kod-kupon"><!-- Content will be populated from discPopCONFIG --></div>
            <button onclick="window.OSDPopup.handleCopyAction()" class="copykupon" id="copyButton">
                <!-- Content will be populated from discPopCONFIG -->
            </button>
        </div>
    </div>
</div>

<!-- Checkout Timer Popup -->
<div id="checkoutTimer" class="checkout-timer">
    <div class="checkout-timer-content">
        <div class="checkout-timer-message">
            <div class="ct-icon">⚡</div>
            <div class="ct-text" id="checkoutTimerText"><!-- Content will be populated from discPopCONFIG --></div>
        </div>
        <div class="checkout-time">
            ⏰ <span id="checkoutTimeDisplay"></span>
        </div>
    </div>
</div>`,o=document.createElement("div");o.innerHTML=t,document.body.appendChild(o)}(),function t(){E(),function t(){let o=g("popup");null!==o?o>0?(n=o,e.debugMode&&console.log(`Resumed popup timer with ${n} seconds remaining`)):(n=0,e.autoDisableCoupon.enabled&&e.autoDisableCoupon.onPopupTimerZero&&B("popup-timer-zero")):n=h();let l=g("checkout");null!==l?l>0?(i=l,u=!0,O(),e.debugMode&&console.log(`Resumed checkout timer with ${i} seconds remaining`)):(i=0,e.autoDisableCoupon.enabled&&e.autoDisableCoupon.onCheckoutTimerZero&&B("checkout-timer-zero"),T()&&R()):i=f();let r=document.getElementById("timeDisplay");if(r){let c=Math.floor(n/60),d=n%60;r.textContent=`${c}:${d.toString().padStart(2,"0")}`}let s=document.getElementById("checkoutTimeDisplay");if(s){let p=Math.floor(i/60),a=i%60;s.textContent=`${p}:${a.toString().padStart(2,"0")}`}}(),function t(){if(function t(){if(!e.autoDisableCoupon.enabled||!e.autoDisableCoupon.maintainDisabledUntilInterval||0===e.showIntervalDays)return!1;let o=localStorage.getItem("couponPopupLastShown"),n=localStorage.getItem("couponTimerExpired");if(!o||!n)return!1;let i=new Date(parseInt(n)),l=new Date;return Math.floor((l-i)/864e5)<e.showIntervalDays}()&&(B("interval-restriction"),e.debugMode)){let o=localStorage.getItem("couponTimerExpired"),n=new Date(parseInt(o)),i=Math.floor((new Date-n)/864e5);console.log(`Coupon disabled by interval restriction. Days since expiry: ${i}/${e.showIntervalDays}`)}}();let o=g("popup");if(null!==o&&o>0){x(),q(),r=!0,e.debugMode&&console.log("Resumed active popup timer on page load");return}let l=g("checkout");if(null!==l&&l>0){u=!0,O(),e.debugMode&&console.log("Resumed active checkout timer on page load");return}if(!S()){e.debugMode&&console.log(`Popup not shown - waiting for ${e.showIntervalDays} day(s) interval`);return}(function t(){if(!e.triggers.exitIntent.enabled||!I(e.triggers.exitIntent))return;let o=!1;c=function(t){!o&&!r&&t.clientY<=e.triggers.exitIntent.sensitivity&&t.movementY<0&&(o=!0,P("exit-intent"))},document.addEventListener("mouseleave",function(e){o||r||!(e.clientY<=0)||(o=!0,P("exit-intent"))}),document.addEventListener("mousemove",c),e.debugMode&&console.log("Exit intent trigger set up")})(),function t(){if(!e.triggers.scroll.enabled||!I(e.triggers.scroll))return;let o=M(),n;n="object"==typeof e.triggers.scroll.percentage?o?e.triggers.scroll.percentage.mobile:e.triggers.scroll.percentage.desktop:e.triggers.scroll.percentage,d=function(){if(r)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-document.documentElement.clientHeight;e/t*100>=n&&P("scroll")},window.addEventListener("scroll",d),e.debugMode&&console.log(`Scroll trigger set up (${n}% on ${o?"mobile":"desktop"})`)}(),function t(){if(!e.triggers.idBased.enabled||!I(e.triggers.idBased))return;let o=document.getElementById(e.triggers.idBased.targetId);if(!o){e.debugMode&&console.log(`Target element #${e.triggers.idBased.targetId} not found`);return}let n={root:null,rootMargin:"0px",threshold:"top"===e.triggers.idBased.triggerPosition?.1:"bottom"===e.triggers.idBased.triggerPosition?.9:.5};(s=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&!r&&P("id-based")})},n)).observe(o),e.debugMode&&console.log(`ID-based trigger set up for #${e.triggers.idBased.targetId}`)}(),e.triggers.delay.enabled&&I(e.triggers.delay)&&(p=setTimeout(()=>{r||P("delay")},1e3*e.triggers.delay.seconds),e.debugMode&&console.log(`Delay trigger set up (${e.triggers.delay.seconds}s)`)),e.debugMode&&console.log("Popup system initialized with triggers:",Object.entries(e.triggers).filter(([e,t])=>t.enabled&&I(t)).map(([e])=>e))}(),document.getElementById("couponPopup").addEventListener("click",function(e){e.target===this&&(_(),B("clicking-overlay"))}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(_(),B("push-escape-key"))})}window.addEventListener("resize",function t(){("object"==typeof e.popupScale||"object"==typeof e.checkoutTimerScale)&&E()}),window.OSDPopup={closeCouponPopup:_,disableCouponElements:B,handleCopyAction:function t(){if(u){_(),function t(){let o=e.coupon.code;setTimeout(()=>{let t=document.querySelector('input[name="coupon_code"]');t?(t.value="",t.value=o,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{let t=document.getElementById("coupon_claim");t?(t.click(),e.debugMode&&console.log("Coupon applied automatically")):e.debugMode&&console.log("Apply coupon button not found")},100)):e.debugMode&&console.log("Coupon input field not found")},300)}(),setTimeout(()=>{let t=document.getElementById("order_form");if(t){let o=0;!function n(){o++;let i=document.querySelectorAll('img[loading="lazy"], img[data-src], .lazy'),l=t.getBoundingClientRect().top+window.pageYOffset,u=Array.from(i).filter(e=>{let t=e.getBoundingClientRect().top+window.pageYOffset;return t<l}),r=u.map(e=>e.complete?Promise.resolve():new Promise(t=>{let o=setTimeout(t,1e3);e.addEventListener("load",()=>{clearTimeout(o),t()},{once:!0})}));Promise.all(r).then(()=>{let i=t.getBoundingClientRect(),l=i.top+window.pageYOffset,u=document.querySelectorAll("header, .header, .navbar"),r=0;u.forEach(e=>{let t=window.getComputedStyle(e);"fixed"===t.position&&(r=Math.max(r,e.offsetHeight))});let c=Math.max(0,l-r-30);window.scrollTo({top:c,behavior:"smooth"}),setTimeout(()=>{let i=t.getBoundingClientRect(),u=i.top+window.pageYOffset;Math.abs(u-l)>20&&o<3&&(e.debugMode&&console.log(`Retrying scroll, attempt ${o+1}`),n())},1500),e.debugMode&&console.log(`Scrolled to order form (attempt ${o})`)})}()}},500),setTimeout(()=>{O()},500);return}let o=e.coupon.code,n=document.getElementById("copyMessage"),i=document.getElementById("copyButton"),r=document.getElementById("popupSubtitle");l=!1,navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(o).then(()=>{H(n,i,r)}).catch(()=>{G(o,n,i,r)}):G(o,n,i,r)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",A):A()}();
