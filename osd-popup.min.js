function initializeTimerDisplays(){let e=document.getElementById("timeDisplay");if(e){let t=getPopupCountdownTime();e.textContent=`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")}`}let o=document.getElementById("topTimeDisplay");if(o){let n=getTopNotificationCountdownTime();o.textContent=`${Math.floor(n/60)}:${(n%60).toString().padStart(2,"0")}`}}function getPopupCountdownTime(){let e=discPopCONFIG.countdown.popup;return 60*(e.minutes||0)+(e.seconds||0)}function getTopNotificationCountdownTime(){let e=discPopCONFIG.countdown.topNotification;return 60*(e.minutes||0)+(e.seconds||0)}function getPopupWarningThreshold(){if(discPopCONFIG.countdown&&discPopCONFIG.countdown.popup&&void 0!==discPopCONFIG.countdown.popup.warningThreshold){let e=discPopCONFIG.countdown.popup.warningThreshold;if("object"==typeof e&&null!==e){let t=e.minutes||0,o=e.seconds||0;return 60*t+o}if("number"==typeof e)return e}return 120}function getTopNotificationWarningThreshold(){if(discPopCONFIG.countdown&&discPopCONFIG.countdown.topNotification&&void 0!==discPopCONFIG.countdown.topNotification.warningThreshold){let e=discPopCONFIG.countdown.topNotification.warningThreshold;if("object"==typeof e&&null!==e){let t=e.minutes||0,o=e.seconds||0;return 60*t+o}if("number"==typeof e)return e}return 180}function getPopupUrgentThreshold(){if(discPopCONFIG.countdown&&discPopCONFIG.countdown.popup&&void 0!==discPopCONFIG.countdown.popup.urgentThreshold){let e=discPopCONFIG.countdown.popup.urgentThreshold;if("object"==typeof e&&null!==e){let t=e.minutes||0,o=e.seconds||0;return 60*t+o}if("number"==typeof e)return e}return 60}function getTopNotificationUrgentThreshold(){if(discPopCONFIG.countdown&&discPopCONFIG.countdown.topNotification&&void 0!==discPopCONFIG.countdown.topNotification.urgentThreshold){let e=discPopCONFIG.countdown.topNotification.urgentThreshold;if("object"==typeof e&&null!==e){let t=e.minutes||0,o=e.seconds||0;return 60*t+o}if("number"==typeof e)return e}return 60}function shouldAutoClosePopupOnZero(){return!discPopCONFIG.countdown||!discPopCONFIG.countdown.popup||void 0===discPopCONFIG.countdown.popup.autoCloseOnZero||discPopCONFIG.countdown.popup.autoCloseOnZero}function shouldAutoHideTopNotificationOnZero(){return discPopCONFIG.countdown&&discPopCONFIG.countdown.topNotification&&void 0!==discPopCONFIG.countdown.topNotification.autoHideOnZero?discPopCONFIG.countdown.topNotification.autoHideOnZero:discPopCONFIG.topNotification?.autoHide!==!1}function shouldClearCouponOnZero(){return!discPopCONFIG.countdown||!discPopCONFIG.countdown.topNotification||void 0===discPopCONFIG.countdown.topNotification.clearCouponOnZero||discPopCONFIG.countdown.topNotification.clearCouponOnZero}function initializeTimerConfiguration(){if(discPopCONFIG.debugMode){let e=e=>{let t=Math.floor(e/60),o=e%60;return t>0&&o>0?`${t}m ${o}s`:t>0?`${t}m`:`${o}s`};console.log("Timer Configuration Loaded:",{popup:{totalTime:e(getPopupCountdownTime()),warningThreshold:e(getPopupWarningThreshold()),urgentThreshold:e(getPopupUrgentThreshold()),autoClose:shouldAutoClosePopupOnZero()},topNotification:{totalTime:e(getTopNotificationCountdownTime()),warningThreshold:e(getTopNotificationWarningThreshold()),urgentThreshold:e(getTopNotificationUrgentThreshold()),autoHide:shouldAutoHideTopNotificationOnZero(),clearCoupon:shouldClearCouponOnZero()}});let t=getPopupCountdownTime(),o=getPopupWarningThreshold(),n=getPopupUrgentThreshold(),i=getTopNotificationCountdownTime(),r=getTopNotificationWarningThreshold(),l=getTopNotificationUrgentThreshold();o>=t&&console.warn("⚠️ WARNING: Popup warning threshold should be less than total popup time"),n>=o&&console.warn("⚠️ WARNING: Popup urgent threshold should be less than warning threshold"),r>=i&&console.warn("⚠️ WARNING: Top notification warning threshold should be less than total notification time"),l>=r&&console.warn("⚠️ WARNING: Top notification urgent threshold should be less than warning threshold")}timeLeft=getPopupCountdownTime(),topTimeLeft=getTopNotificationCountdownTime()}let countdownTimer,topNotificationTimer,timeLeft=getPopupCountdownTime(),topTimeLeft=getTopNotificationCountdownTime(),isTimerPaused=!1,isCopied=!1,popupTriggered=!1,exitIntentListener=null,scrollListener=null,intersectionObserver=null,delayTimer=null;function isMobileDevice(){return window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function shouldTriggerOnDevice(e){let t=isMobileDevice();return t?e.mobile:e.desktop}function initializePopupContent(){if(discPopCONFIG.popupScale){let e=document.querySelector(".coupon-popup"),t;if("object"==typeof discPopCONFIG.popupScale){let o=window.innerWidth;t=o<=480?discPopCONFIG.popupScale.mobile||.9:o<=768?discPopCONFIG.popupScale.tablet||1:discPopCONFIG.popupScale.desktop||1.1}else t=discPopCONFIG.popupScale;1!==t&&e.style.setProperty("--popup-scale",t),discPopCONFIG.debugMode&&console.log(`Popup scale set to: ${t} (screen: ${window.innerWidth}px)`)}if(discPopCONFIG.topNotificationScale){let n=document.querySelector(".top-notification");if(!n)return;let i;if("object"==typeof discPopCONFIG.topNotificationScale){let r=window.innerWidth;i=r<=480?discPopCONFIG.topNotificationScale.mobile||.9:r<=768?discPopCONFIG.topNotificationScale.tablet||.95:discPopCONFIG.topNotificationScale.desktop||1}else i=discPopCONFIG.topNotificationScale;n.style.setProperty("--top-notification-scale",i),discPopCONFIG.debugMode&&console.log(`Top notification scale set to: ${i} (screen: ${window.innerWidth}px)`)}if(discPopCONFIG.topNotification){let l=document.querySelector(".top-notification");if(l){let s=discPopCONFIG.topNotification.position||"top";l.classList.remove("position-top","position-bottom"),l.classList.add(`position-${s}`);let p=discPopCONFIG.topNotification.offsetDistance||20;l.style.setProperty("--notification-offset",`${p}px`);let a=document.getElementById("topNotificationText");a&&discPopCONFIG.topNotification.message&&(a.textContent=discPopCONFIG.topNotification.message),discPopCONFIG.debugMode&&console.log(`Top notification positioned: ${s} with ${p}px offset`)}}let u=document.querySelector(".popup-title");u&&(u.innerHTML=discPopCONFIG.coupon.title);let d=document.querySelector(".popup-subtitle");if(d){let c=discPopCONFIG.coupon.subtitle;c=c.replace("{discount}",discPopCONFIG.coupon.discount),d.innerHTML=c}let g=document.getElementById("kod-kupon");g&&(g.textContent=discPopCONFIG.coupon.code);let f=document.getElementById("copyMessage");f&&(f.innerHTML=discPopCONFIG.coupon.copyMessage);let m=document.getElementById("copyButton");m&&(m.textContent=discPopCONFIG.coupon.copyButtonText),discPopCONFIG.debugMode&&console.log("Popup content initialized with discPopCONFIG values")}function handleWindowResize(){("object"==typeof discPopCONFIG.popupScale||"object"==typeof discPopCONFIG.topNotificationScale)&&initializePopupContent()}function shouldShowPopup(){if(0===discPopCONFIG.showIntervalDays)return!0;let e=localStorage.getItem("couponPopupLastShown");if(!e)return!0;let t=new Date(parseInt(e)),o=new Date,n=Math.floor((o-t)/864e5);return discPopCONFIG.debugMode&&console.log(`Days since last shown: ${n}, Required interval: ${discPopCONFIG.showIntervalDays}`),n>=discPopCONFIG.showIntervalDays}function setupExitIntentTrigger(){if(!discPopCONFIG.triggers.exitIntent.enabled||!shouldTriggerOnDevice(discPopCONFIG.triggers.exitIntent))return;let e=!1;exitIntentListener=function(t){!e&&!popupTriggered&&t.clientY<=discPopCONFIG.triggers.exitIntent.sensitivity&&t.movementY<0&&(e=!0,triggerPopup("exit-intent"))},document.addEventListener("mouseleave",function(t){e||popupTriggered||!(t.clientY<=0)||(e=!0,triggerPopup("exit-intent"))}),document.addEventListener("mousemove",exitIntentListener),discPopCONFIG.debugMode&&console.log("Exit intent trigger set up")}function setupScrollTrigger(){if(!discPopCONFIG.triggers.scroll.enabled||!shouldTriggerOnDevice(discPopCONFIG.triggers.scroll))return;let e=isMobileDevice(),t;t="object"==typeof discPopCONFIG.triggers.scroll.percentage?e?discPopCONFIG.triggers.scroll.percentage.mobile:discPopCONFIG.triggers.scroll.percentage.desktop:discPopCONFIG.triggers.scroll.percentage,scrollListener=function(){if(popupTriggered)return;let e=window.pageYOffset||document.documentElement.scrollTop,o=document.documentElement.scrollHeight-document.documentElement.clientHeight;e/o*100>=t&&triggerPopup("scroll")},window.addEventListener("scroll",scrollListener),discPopCONFIG.debugMode&&console.log(`Scroll trigger set up (${t}% on ${e?"mobile":"desktop"})`)}function setupIdBasedTrigger(){if(!discPopCONFIG.triggers.idBased.enabled||!shouldTriggerOnDevice(discPopCONFIG.triggers.idBased))return;let e=document.getElementById(discPopCONFIG.triggers.idBased.targetId);if(!e){discPopCONFIG.debugMode&&console.log(`Target element #${discPopCONFIG.triggers.idBased.targetId} not found`);return}let t={root:null,rootMargin:"0px",threshold:"top"===discPopCONFIG.triggers.idBased.triggerPosition?.1:"bottom"===discPopCONFIG.triggers.idBased.triggerPosition?.9:.5};(intersectionObserver=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&!popupTriggered&&triggerPopup("id-based")})},t)).observe(e),discPopCONFIG.debugMode&&console.log(`ID-based trigger set up for #${discPopCONFIG.triggers.idBased.targetId}`)}function setupDelayTrigger(){discPopCONFIG.triggers.delay.enabled&&shouldTriggerOnDevice(discPopCONFIG.triggers.delay)&&(delayTimer=setTimeout(()=>{popupTriggered||triggerPopup("delay")},1e3*discPopCONFIG.triggers.delay.seconds),discPopCONFIG.debugMode&&console.log(`Delay trigger set up (${discPopCONFIG.triggers.delay.seconds}s)`))}function triggerPopup(e){!popupTriggered&&shouldShowPopup()&&(popupTriggered=!0,discPopCONFIG.debugMode&&console.log(`Popup triggered by: ${e}`),showCouponPopup(),startCountdown(),cleanupTriggers())}function cleanupTriggers(){exitIntentListener&&document.removeEventListener("mousemove",exitIntentListener),scrollListener&&window.removeEventListener("scroll",scrollListener),intersectionObserver&&intersectionObserver.disconnect(),delayTimer&&clearTimeout(delayTimer)}function disableCouponElements(e="timer"){if(!discPopCONFIG.autoDisable.enabled)return;let t=discPopCONFIG.autoDisable,o=document.querySelector(t.targets.couponField);o&&(("disable"===t.disableMethod||"both"===t.disableMethod)&&(o.disabled=!0,o.style.opacity="0.5",o.style.cursor="not-allowed"),("hide"===t.disableMethod||"both"===t.disableMethod)&&(o.style.display="none"));let n=document.querySelector(t.targets.couponButton);if(n&&(("disable"===t.disableMethod||"both"===t.disableMethod)&&(n.disabled=!0,n.style.opacity="0.5",n.style.cursor="not-allowed",n.onclick=function(e){return e.preventDefault(),!1}),("hide"===t.disableMethod||"both"===t.disableMethod)&&(n.style.display="none")),t.showDisableMessage&&showDisableMessage("interval-restriction"===e),"popup-timer-zero"===e||"top-notification-timer-zero"===e){let i=new Date().getTime();localStorage.setItem("couponTimerExpired",i.toString())}discPopCONFIG.debugMode&&console.log(`Coupon elements disabled due to: ${e}`)}function showDisableMessage(e=!1){let t=discPopCONFIG.autoDisable,o=document.getElementById("couponDisabledMessage");o&&o.remove();let n=document.createElement("div");n.id="couponDisabledMessage",n.textContent=e?t.intervalDisableMessage:t.disableMessage;let i=document.querySelector(t.targets.couponButton);i&&i.parentNode?i.parentNode.insertBefore(n,i.nextSibling):document.body.appendChild(n)}function hideDisableMessage(){let e=document.getElementById("couponDisabledMessage");e&&e.remove()}function shouldDisableCouponByInterval(){if(!discPopCONFIG.autoDisable.enabled||!discPopCONFIG.autoDisable.maintainDisabledUntilInterval||0===discPopCONFIG.showIntervalDays)return!1;let e=localStorage.getItem("couponPopupLastShown"),t=localStorage.getItem("couponTimerExpired");if(!e||!t)return!1;let o=new Date(parseInt(t)),n=new Date;return Math.floor((n-o)/864e5)<discPopCONFIG.showIntervalDays}function checkAndDisableOnPageLoad(){if(shouldDisableCouponByInterval()&&(disableCouponElements("interval-restriction"),discPopCONFIG.debugMode)){let e=localStorage.getItem("couponTimerExpired"),t=new Date(parseInt(e)),o=Math.floor((new Date-t)/864e5);console.log(`Coupon disabled by interval restriction. Days since expiry: ${o}/${discPopCONFIG.showIntervalDays}`)}}function initPopupSystem(){if(initializePopupContent(),initializeTimerDisplays(),checkAndDisableOnPageLoad(),!shouldShowPopup()){discPopCONFIG.debugMode&&console.log(`Popup not shown - waiting for ${discPopCONFIG.showIntervalDays} day(s) interval`);return}setupExitIntentTrigger(),setupScrollTrigger(),setupIdBasedTrigger(),setupDelayTrigger(),discPopCONFIG.debugMode&&console.log("Popup system initialized with triggers:",Object.entries(discPopCONFIG.triggers).filter(([e,t])=>t.enabled&&shouldTriggerOnDevice(t)).map(([e])=>e))}function showCouponPopup(){let e=document.getElementById("couponPopup");if(e.classList.add("show"),discPopCONFIG.showIntervalDays>0){let t=new Date().getTime();localStorage.setItem("couponPopupLastShown",t.toString())}discPopCONFIG.debugMode&&console.log("Popup shown")}function closeCouponPopup(){let e=document.getElementById("couponPopup");e.classList.remove("show"),countdownTimer&&clearInterval(countdownTimer),cleanupTriggers(),discPopCONFIG.debugMode&&console.log("Popup closed")}function showTopNotification(){let e=document.getElementById("topNotification");e.classList.add("show"),startTopNotificationTimer(),discPopCONFIG.debugMode&&console.log("Top notification shown")}function hideTopNotification(){let e=document.getElementById("topNotification");e.classList.remove("show"),topNotificationTimer&&clearInterval(topNotificationTimer),discPopCONFIG.debugMode&&console.log("Top notification hidden")}function startTopNotificationTimer(){document.getElementById("topTimeDisplay");let e=document.getElementById("topNotification"),t=getTopNotificationUrgentThreshold(),o=getTopNotificationWarningThreshold();topNotificationTimer=setInterval(()=>{if(topTimeLeft<=0){discPopCONFIG.autoDisable.enabled&&discPopCONFIG.autoDisable.onTopNotificationTimerZero&&disableCouponElements("top-notification-timer-zero"),shouldAutoHideTopNotificationOnZero()&&hideTopNotification(),shouldClearCouponOnZero()&&clearCouponOnZero();return}topTimeLeft--,updateTopTimeDisplay(),topTimeLeft<=o&&topTimeLeft>t&&!e.classList.contains("warning")&&(e.classList.add("warning"),discPopCONFIG.debugMode&&console.log(`Top notification entered warning mode at ${topTimeLeft} seconds`)),topTimeLeft<=t&&!e.classList.contains("urgent")&&(e.classList.remove("warning"),e.classList.add("urgent"),discPopCONFIG.debugMode&&console.log(`Top notification entered urgent mode at ${topTimeLeft} seconds`))},1e3)}function clearClipboard(){try{navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText("").then(()=>{discPopCONFIG.debugMode&&console.log("Clipboard cleared successfully")}).catch(e=>{discPopCONFIG.debugMode&&console.log("Failed to clear clipboard:",e),fallbackClearClipboard()}):fallbackClearClipboard()}catch(e){discPopCONFIG.debugMode&&console.log("Error clearing clipboard:",e)}}function fallbackClearClipboard(){try{let e=document.createElement("input");e.value="",document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),discPopCONFIG.debugMode&&console.log("Clipboard cleared using fallback method")}catch(t){discPopCONFIG.debugMode&&console.log("Fallback clipboard clear failed:",t)}}function clearCouponOnZero(){clearClipboard();let e=document.getElementById("coupon_cancel");e&&e.click()}function startCountdown(){document.getElementById("timeDisplay");let e=document.getElementById("countdownTimer"),t=getPopupUrgentThreshold(),o=getPopupWarningThreshold();countdownTimer=setInterval(()=>{if(!isTimerPaused){if(timeLeft<=0){discPopCONFIG.autoDisable.enabled&&discPopCONFIG.autoDisable.onPopupTimerZero&&disableCouponElements("popup-timer-zero"),shouldAutoClosePopupOnZero()&&closeCouponPopup();return}timeLeft--,updateTimeDisplay(),timeLeft<=o&&timeLeft>t&&!e.classList.contains("warning")&&(e.classList.add("warning"),discPopCONFIG.debugMode&&console.log(`Popup countdown entered warning mode at ${timeLeft} seconds`)),timeLeft<=t&&!e.classList.contains("urgent")&&(e.classList.remove("warning"),e.classList.add("urgent"),e.style.animation="pulse 1s infinite",discPopCONFIG.debugMode&&console.log(`Popup countdown entered urgent mode at ${timeLeft} seconds`))}},1e3)}function updateTimeDisplay(){let e=Math.floor(timeLeft/60),t=timeLeft%60,o=document.getElementById("timeDisplay");o.textContent=`${e}:${t.toString().padStart(2,"0")}`}function updateTopTimeDisplay(){let e=Math.floor(topTimeLeft/60),t=topTimeLeft%60,o=document.getElementById("topTimeDisplay");o.textContent=`${e}:${t.toString().padStart(2,"0")}`}function handleCopyAction(){if(isCopied){closeCouponPopup(),autoApplyCoupon(),setTimeout(()=>{let e=document.getElementById("order_form");if(e){let t=0;!function o(){t++;let n=document.querySelectorAll('img[loading="lazy"], img[data-src], .lazy'),i=e.getBoundingClientRect().top+window.pageYOffset,r=Array.from(n).filter(e=>{let t=e.getBoundingClientRect().top+window.pageYOffset;return t<i}),l=r.map(e=>e.complete?Promise.resolve():new Promise(t=>{let o=setTimeout(t,1e3);e.addEventListener("load",()=>{clearTimeout(o),t()},{once:!0})}));Promise.all(l).then(()=>{let n=e.getBoundingClientRect(),i=n.top+window.pageYOffset,r=document.querySelectorAll("header, .header, .navbar"),l=0;r.forEach(e=>{let t=window.getComputedStyle(e);"fixed"===t.position&&(l=Math.max(l,e.offsetHeight))});let s=Math.max(0,i-l-30);window.scrollTo({top:s,behavior:"smooth"}),setTimeout(()=>{let n=e.getBoundingClientRect(),r=n.top+window.pageYOffset;Math.abs(r-i)>20&&t<3&&(discPopCONFIG.debugMode&&console.log(`Retrying scroll, attempt ${t+1}`),o())},1500),discPopCONFIG.debugMode&&console.log(`Scrolled to order form (attempt ${t})`)})}()}},500),setTimeout(()=>{showTopNotification()},500);return}let e=discPopCONFIG.coupon.code,t=document.getElementById("copyMessage"),o=document.getElementById("copyButton"),n=document.getElementById("popupSubtitle");isTimerPaused=!1,navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{showCopySuccess(t,o,n)}).catch(()=>{fallbackCopyMethod(e,t,o,n)}):fallbackCopyMethod(e,t,o,n)}function autoApplyCoupon(){let e=discPopCONFIG.coupon.code;setTimeout(()=>{let t=document.querySelector('input[name="coupon_code"]');t?(t.value="",t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(()=>{let e=document.getElementById("coupon_claim");e?(e.click(),discPopCONFIG.debugMode&&console.log("Coupon applied automatically")):discPopCONFIG.debugMode&&console.log("Apply coupon button not found")},100)):discPopCONFIG.debugMode&&console.log("Coupon input field not found")},300)}function fallbackCopyMethod(e,t,o,n){let i=document.createElement("input");i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),i.remove(),showCopySuccess(t,o,n)}function showCopySuccess(e,t,o){isCopied=!0,e.classList.add("show"),o.classList.add("hide"),t.classList.add("checkout-kupon"),t.textContent=discPopCONFIG.coupon.checkoutButtonText,discPopCONFIG.debugMode&&console.log("Coupon copied successfully")}window.addEventListener("resize",handleWindowResize),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initPopupSystem):initPopupSystem(),document.getElementById("couponPopup").addEventListener("click",function(e){e.target===this&&(closeCouponPopup(),disableCouponElements("clicking-overlay"))}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(closeCouponPopup(),disableCouponElements("push-escape-key"))});